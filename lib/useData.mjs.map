{"version":3,"file":"useData.mjs","sources":["../src/UseDataContextProvider.tsx","../src/useData.ts","../src/useMutatingData.ts"],"sourcesContent":["\"use client\";\n\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { PropsWithChildren } from \"react\";\n\nexport function UseDataContextProvider({\n  client,\n  children,\n}: Readonly<PropsWithChildren<{ client: QueryClient }>>) {\n  return <QueryClientProvider client={client}>{children}</QueryClientProvider>;\n}\n","import { QueryKey, useQuery } from \"@tanstack/react-query\";\nimport { useMemo } from \"react\";\n\nexport interface LoadingHook<TData> {\n  isLoading: boolean;\n  isError: boolean;\n  data: TData | undefined;\n  error: Error | undefined;\n}\n\nexport type QueryFn<TData> = () => Promise<TData> | TData | undefined;\n\nexport function useData<TData, TQueryKey extends QueryKey>(\n  queryKey: TQueryKey,\n  queryFn: QueryFn<TData>\n): LoadingHook<TData> {\n  const {\n    data: queryData,\n    status: queryStatus,\n    error: queryError,\n  } = useQuery({\n    queryKey,\n    queryFn,\n  });\n\n  const value = useMemo<LoadingHook<TData>>(\n    () => ({\n      isLoading: queryStatus === \"pending\",\n      isError: queryStatus === \"error\",\n      data: queryData,\n      error: queryError || undefined,\n    }),\n    [queryData, queryStatus]\n  );\n\n  return value;\n}\n","import { QueryKey, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useMemo } from \"react\";\nimport { LoadingHook, QueryFn, useData } from \"./useData\";\n\nexport interface UpdateCallbacks<TData> {\n  onSettled?: (data: TData) => void;\n}\n\ninterface UpdateHook<TData> extends LoadingHook<TData> {\n  update: (data: Partial<TData>, callbacks?: UpdateCallbacks<TData>) => void;\n  updating: boolean;\n}\n\nexport function useMutatingData<\n  TData extends object,\n  TQueryKey extends QueryKey\n>(\n  queryKey: TQueryKey,\n  queryFn: QueryFn<TData>,\n  mutationFn: (data: Partial<TData>) => Promise<TData>\n): UpdateHook<TData> {\n  const queryClient = useQueryClient();\n  const dataHook = useData(queryKey, queryFn);\n\n  const { mutate, isPending } = useMutation({\n    mutationFn,\n    onMutate: async (newData: Partial<TData>) => {\n      await queryClient.cancelQueries({ queryKey });\n      queryClient.setQueryData<TData>(\n        queryKey,\n        (oldData) => ({ ...oldData, ...newData } as TData)\n      );\n      const updatedData = queryClient.getQueryData(queryKey);\n      return { data: updatedData };\n    },\n    onError: (err, newData, context) => {\n      //TODO Pass error to caller\n      queryClient.setQueryData(queryKey, context?.data);\n    },\n    onSettled: () => {\n      queryClient.invalidateQueries({ queryKey });\n    },\n  });\n\n  const value = useMemo<UpdateHook<TData>>(\n    () => ({\n      ...dataHook,\n      update: (data, callbacks) =>\n        mutate(data, {\n          onSettled: (data) => {\n            if (callbacks && callbacks.onSettled && data) {\n              callbacks.onSettled(data);\n            }\n          },\n        }),\n      updating: isPending,\n    }),\n    [dataHook, isPending]\n  );\n\n  return value;\n}\n"],"names":["_jsx"],"mappings":";;;;SAKgB,sBAAsB,CAAC,EACrC,MAAM,EACN,QAAQ,GAC6C,EAAA;IACrD,OAAOA,GAAA,CAAC,mBAAmB,EAAC,EAAA,MAAM,EAAE,MAAM,EAAA,QAAA,EAAG,QAAQ,EAAA,CAAuB,CAAC;AAC/E;;ACEgB,SAAA,OAAO,CACrB,QAAmB,EACnB,OAAuB,EAAA;AAEvB,IAAA,MAAM,EACJ,IAAI,EAAE,SAAS,EACf,MAAM,EAAE,WAAW,EACnB,KAAK,EAAE,UAAU,GAClB,GAAG,QAAQ,CAAC;QACX,QAAQ;QACR,OAAO;AACR,KAAA,CAAC,CAAC;AAEH,IAAA,MAAM,KAAK,GAAG,OAAO,CACnB,OAAO;QACL,SAAS,EAAE,WAAW,KAAK,SAAS;QACpC,OAAO,EAAE,WAAW,KAAK,OAAO;AAChC,QAAA,IAAI,EAAE,SAAS;QACf,KAAK,EAAE,UAAU,IAAI,SAAS;AAC/B,KAAA,CAAC,EACF,CAAC,SAAS,EAAE,WAAW,CAAC,CACzB,CAAC;AAEF,IAAA,OAAO,KAAK,CAAC;AACf;;SCvBgB,eAAe,CAI7B,QAAmB,EACnB,OAAuB,EACvB,UAAoD,EAAA;AAEpD,IAAA,MAAM,WAAW,GAAG,cAAc,EAAE,CAAC;IACrC,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;AAE5C,IAAA,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,WAAW,CAAC;QACxC,UAAU;AACV,QAAA,QAAQ,EAAE,OAAO,OAAuB,KAAI;YAC1C,MAAM,WAAW,CAAC,aAAa,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;YAC9C,WAAW,CAAC,YAAY,CACtB,QAAQ,EACR,CAAC,OAAO,MAAM,EAAE,GAAG,OAAO,EAAE,GAAG,OAAO,EAAY,CAAA,CACnD,CAAC;YACF,MAAM,WAAW,GAAG,WAAW,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;AACvD,YAAA,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC;SAC9B;QACD,OAAO,EAAE,CAAC,GAAG,EAAE,OAAO,EAAE,OAAO,KAAI;;YAEjC,WAAW,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;SACnD;QACD,SAAS,EAAE,MAAK;AACd,YAAA,WAAW,CAAC,iBAAiB,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;SAC7C;AACF,KAAA,CAAC,CAAC;AAEH,IAAA,MAAM,KAAK,GAAG,OAAO,CACnB,OAAO;AACL,QAAA,GAAG,QAAQ;QACX,MAAM,EAAE,CAAC,IAAI,EAAE,SAAS,KACtB,MAAM,CAAC,IAAI,EAAE;AACX,YAAA,SAAS,EAAE,CAAC,IAAI,KAAI;AAClB,gBAAA,IAAI,SAAS,IAAI,SAAS,CAAC,SAAS,IAAI,IAAI,EAAE;AAC5C,oBAAA,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AAC3B,iBAAA;aACF;SACF,CAAC;AACJ,QAAA,QAAQ,EAAE,SAAS;AACpB,KAAA,CAAC,EACF,CAAC,QAAQ,EAAE,SAAS,CAAC,CACtB,CAAC;AAEF,IAAA,OAAO,KAAK,CAAC;AACf;;;;"}